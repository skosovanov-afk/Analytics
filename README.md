# Product — Hypotheses & Calls MVP

## ТЗ (MVP)

Цель: единая система для **создания B2B-гипотез**, **привязки звонков** к гипотезам и **сбора недельных метрик** по каналам с **ролевым доступом**, плюс **генерация карточки гипотезы** в Markdown в репозитории (как база знаний внутри Cursor).

### Пользовательские роли
- **admin**: видит всё, управляет пользователями и справочниками.
- **bizdev**: видит только свои звонки/гипотезы/метрики.
- **marketing**: видит свои гипотезы/метрики; звонки опционально (в MVP — только свои).
- **outreach**: видит свои гипотезы/метрики; звонки опционально (в MVP — только свои).

В MVP владелец сущности определяется полем `owner_user_id`. Доступ: пользователь видит записи, где он `owner`, либо всё если он `admin`.

### Сущности
- **Hypothesis**: гипотеза (фреймворк-структура: сегмент, проблема, предположение, канал, метрика успеха, минимальный сигнал, сроки, статус).
- **Call**: звонок (дата, компания/контакт, источник, краткое резюме/ссылка на транскрипт).
- **CallLink**: связь "звонок ↔ гипотеза".
- **WeeklyMetric**: недельные метрики по гипотезе/каналу/владельцу.
- **User**: пользователь (email, роль).

### Потоки (MVP)
1) **Создание гипотезы**:
   - форма создания → запись в БД
   - генерация markdown-карточки `knowledge/hypotheses/<id>.md`

2) **Загрузка/просмотр звонков**:
   - в MVP звонки добавляются через API/простую форму (интеграции с телефонией/HubSpot позже)

3) **Привязка звонков к гипотезе**:
   - пользователь выбирает свои звонки и привязывает к гипотезе

4) **Сбор статистики**:
   - недельная форма метрик
   - форма и поля зависят от роли (outreach/marketing/bizdev)

5) **Обновление карточки**:
   - по кнопке/эндпоинту система пересобирает markdown по данным БД (звонки + метрики + статус)

### Ограничения MVP
- Без реальных интеграций (HubSpot/телефония/LLM) — только stubs/заглушки.
- Авторизация упрощённая: login по email (без пароля) для демо-режима.
- Хранилище: SQLite (async) по умолчанию, чтобы запускалось локально.

## Логика v2 (VP-матрица + TAL) — без таблиц

VP-матрица — это пересечение **трёх осей**:
- **ICP / сегмент**: “куда идём” (индустрия/под-индустрия/размер/регион/контекст).
- **Роль в компании**: кто принимает решение (например CFO/CEO/COO).
- **Основная боль → желаемый исход**: формулировка “что болит” и “чего хотят”.

На пересечении фиксируется:
- **Одна чёткая Value Proposition (VP)**: одно сообщение, которое тестируем (а не “мы для всех”).

Дальше от этой ячейки строится выполнение:
- **Гипотеза** выбирает одну ячейку VP-матрицы и проверяет её в каналах (outreach/marketing/bizdev).
- **TAL (Target Account List)** создаётся с нуля для гипотезы: список компаний, куда идём, с прогрессом по воронке.
- **Звонки** и **метрики** линкуются к гипотезе, чтобы видеть фактический результат теста.
- **Результат** фиксируется как “ожидания vs факты” + решение (continue/pivot/kill).

## Стек
- Python 3.10+
- FastAPI + Jinja2 templates (простые веб-формы)
- SQLAlchemy 2.x (async) + aiosqlite
- pytest + pytest-asyncio

## Быстрый старт

```bash
python -m venv .venv
.\.venv\Scripts\activate
pip install -r requirements.txt
uvicorn app.main:app --reload
```

Откройте:
- `http://127.0.0.1:8000/` — домашняя страница


