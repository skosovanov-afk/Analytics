{% extends "base.html" %}
{% block content %}
  <div class="card">
    <div class="row">
      <div>
        <div style="font-weight:700; font-size:16px;">Companies</div>
        <div class="muted">Всего в базе: <span class="pill">{{ total }}</span></div>
      </div>
      <div class="row" style="gap: 8px;">
        {% if can_import %}
          <form method="post" action="/companies/import" style="margin:0">
            <button class="btn" type="submit">Import from Companies.csv</button>
          </form>
        {% endif %}
      </div>
    </div>

    <form method="get" action="/companies" style="margin-top: 12px;">
      <div class="grid">
        <div>
          <label>Search</label>
          <input name="q" value="{{ q or '' }}" placeholder="name or website" />
        </div>
        <div>
          <label>ICP</label>
          <input name="icp" value="{{ icp or '' }}" placeholder="e.g. Ad Tech" />
        </div>
      </div>
      <div style="margin-top: 10px; justify-content: flex-start;" class="row">
        <button class="btn secondary" type="submit">Filter</button>
        <a class="btn secondary" href="/companies">Reset</a>
        {% if last_import %}
          <span class="muted" style="font-size: 13px;">Last import: inserted {{ last_import.inserted }}, skipped {{ last_import.skipped }}</span>
        {% endif %}
      </div>
    </form>

    <div style="margin-top: 12px;">
      {% if companies|length == 0 %}
        <div class="muted">Пока пусто. {% if can_import %}Нажми “Import from Companies.csv”.{% else %}Зайди ролью <code>admin</code>, чтобы импортировать.{% endif %}</div>
      {% else %}
        <ul class="list">
          {% for c in companies %}
            <li>
              <div class="row">
                <div>
                  <div style="font-weight:700;">{{ c.name or "—" }}</div>
                  <div class="muted" style="font-size: 13px;">
                    Website: {{ c.website or "—" }}
                    · ICP: <span class="pill">{{ c.icp or "—" }}</span>
                    {% if c.score %}· Score: <span class="pill">{{ c.score }}</span>{% endif %}
                  </div>
                </div>
              </div>
              {% if c.notes %}
                <div class="muted" style="margin-top: 6px; white-space: pre-wrap; font-size: 13px;">{{ c.notes }}</div>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>
  </div>
{% endblock %}

